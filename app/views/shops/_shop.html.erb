<!-- Testimonials block -->
<div class="main-block">
  <!-- Block container -->
  <div class="shop-container row">

    <!-- Block header -->
    <div class="shop-block-header col-12">
      <% if shop.address.present? %>
        <div class="shop-map" id="shop-map"></div>
      <% else %>
        <div class="shop-map"></div>
      <% end %>
    </div><!-- /End Block header -->

    <!-- Block body -->
    <div class="shop-block-body col-12">
      <!-- Block heading -->
      <div class="shop-block-heading">
        <table>
          <tbody>
            <tr>
              <th>店舗名</th>
              <td><%= shop.name %></td>
            </tr>
            <tr>
              <th>住所</th>
              <td><%= shop.address %></td>
            </tr>
            <tr>
              <th>URL</th>
              <td><%= shop.link %></td>
            </tr>
          </tbody>
        </table>
      </div><!-- /End Block heading -->
    </div><!--/End Block body -->

    <div class="col-lg-12">
      <div class="shop-block-content">
        <div class="shop-block-info row">
          <div class="offset-lg-2 col-lg-8"><h2>フレーバー</h2></div>
          <% if current_user.present? %>
            <div class="col-lg-2"><%= link_to "在庫管理", flavors_shop_path(shop), class: "btn btn-md btn-round btn-success ml-18 mr-18 mb-36 text-white" %></div>
          <% end %>

          <% categories.each do |category| %>
            <div class="main-block-title">
              <span><%= category.name %></span>
            </div>
            <% flavors.where(category_id: category.id).each do |flavor| %>
              <div class="col-lg-4">
                <!-- Block -->
                <div class="main-block">
                  <!-- Block container -->
                  <div class="main-block-container">
                    <!-- Block body -->
                    <div class="main-block-body">
                      <!-- Block content -->
                      <div class="main-block-content">
                        <ul class="main-block-list">
                          <li>
                            <div class="row item-block">
                              <div class="col-8 item-name">
                                <%= link_to flavor_path(flavor) do %>
                                  <%= flavor.name %>
                                <% end %>
                              </div>
                              <div class="col-4 stock-flavor-check" id="stock_flavor_<%= flavor.id %>_status">
                                <% if current_user.present? && shop.user.id == current_user.id %>
                                  <%= render 'stocks/status_button', {shop: shop, flavor: flavor} %>
                                <% else %>
                                  <span></span>
                                <% end %>
                              </div>
                            </div>
                          </li>
                        </ul>
                      </div><!-- /End Block content -->
                    </div><!--/End Block body -->
                  </div><!-- /End Block container -->
                </div><!-- /End Block -->
              </div><!-- /End col-lg-4 -->
            <% end %>
          <% end %>

        </div>
      </div>
    </div>


  </div><!-- /End Block container -->
</div><!-- /End Testimonials block -->


<script>
  function initMap(){
    let latlng = {lat: <%= @shop.latitude %>, lng: <%= @shop.longitude %> };
    let map = new google.maps.Map(document.getElementById('shop-map'), {
    center: latlng,
    zoom: 17,
    disableDefaultUI: true,
    });
    const markerOption = {
      position: latlng,
      map: map, 
    }

    const marker = new google.maps.Marker(markerOption);
  }

</script>

<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['API_KEY'] %>&callback=initMap" async defer>
</script>